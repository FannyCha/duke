
	#################
	# Usage:
	# 
	# Targets:
	#     dist     : full build & installation 
	#     tests    : run unit-test suite
	# 
	# Options:
	#     --no-<plugin>    : removes plugin <plugin> from build list
	#
	#################

import os ;
import set ;

using pb : $(PROTOC) ;

## Configuration

local 				BOOST_ROOT 			= [ modules.peek : BOOST_ROOT ] ; 
use-project /boost 						: $(BOOST_ROOT) ;
use-project /duke/lib/engine			: src/libraries/dukeengine ;
use-project /duke/lib/api				: src/libraries/dukeapi ;
use-project /duke/lib/io				: src/libraries/dukeio ;
use-project /duke/lib/ioplugin			: src/libraries/dukeio/plugin ;
use-project /duke/lib/renderer			: src/libraries/dukerenderer ;
use-project /duke/lib/rendererplugin	: src/libraries/dukerenderer/plugin ;
use-project /duke/sub/duke.plugins		: src/submodules/duke.plugins ;

project : requirements 
			<threading>multi
			<toolset>gcc:<cxxflags>-isystem$(BOOST_ROOT) # will prevent warnings within boost
			<os>NT:<define>WIN32_LEAN_AND_MEAN
			<os>NT:<define>VC_EXTRALEAN
			<os>NT:<define>_WIN32_WINNT=0x0501
		: build-dir bin	;


## Main targets

explicit applications
		 plugins
		 tests
		 plugin-jpg
		 plugin-dpx
		 plugin-oiio
		 plugin-ogl
		 plugin-dx9
		 shader_prototypes
		 dist ;

alias applications 	: src/applications/duke//duke ; # src/applications/diskbench//diskbench ;
alias plugins 		: plugin-jpg plugin-dpx plugin-oiio plugin-ogl : <os>LINUX ;
alias plugins 		: plugin-jpg plugin-dpx plugin-oiio plugin-ogl : <os>MACOSX ;
alias plugins 		: plugin-jpg plugin-dpx plugin-dx9 plugin-ogl : <os>NT ;
alias tests 		: [ glob src/tests/* : src/tests/renderer src/tests/scripts ] ;
alias plugin-jpg	: src/plugins/io/jpg//jpg ;
alias plugin-dpx	: src/plugins/io/dpx//dpx ;
alias plugin-oiio	: src/plugins/io/oiio//oiio ;
alias plugin-ogl	: src/plugins/renderer/ogl//ogl ;
alias plugin-dx9	: src/plugins/renderer/dx9//dx9 ;
alias mingw_runtime ;
alias mingw_runtime : /user-config//mwingw_runtime : <os>NT <toolset>gcc ;


install shader_prototypes :
	[ glob resources/shader_prototypes/* ]
	:
	<variant>debug:<location>dist/debug/shader_prototypes
	<variant>release:<location>dist/release/shader_prototypes
	;

install dist :
    mingw_runtime
	applications
	plugins
	shader_prototypes
	:
	<install-dependencies>on
	<install-type>SHARED_LIB
	<install-type>SEARCHED_LIB
	<install-type>EXE
	<variant>debug:<location>dist/debug
	<variant>release:<location>dist/release
	<dependency>shader_prototypes
	;
